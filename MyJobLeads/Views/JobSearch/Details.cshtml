@model MyJobLeads.ViewModels.JobSearches.JobSearchDetailsViewModel
@using MyJobLeads.DomainModel.Entities;
@using MyJobLeads.Infrastructure.HtmlHelpers;

@{
    ViewBag.Title = Model.JobSearch.Name + " - Job Search";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Sidebar = Html.Partial(MVC.Task.Views._OpenTaskSummary, Model.OpenTasks);
}

<h1>@Model.JobSearch.Name</h1>
<br />

<p>
    @Html.ActionLink("Edit This Job Search", MVC.JobSearch.Edit(Model.JobSearch.Id)) &nbsp; 
    @Html.ActionLink("View All Job Searches", MVC.JobSearch.Index())
</p>

<p>
    @if (!string.IsNullOrWhiteSpace(Model.JobSearch.Description)) { <text><b>Description:</b> @Model.JobSearch.Description</text> }
</p>

<p>
    @using (Html.BeginForm(MVC.JobSearch.Search(), FormMethod.Get))
    {
        @Html.Hidden("id", Model.JobSearch.Id)
        @:Search: @Html.TextBox("query") <input type="submit" value="Search" />
    }
</p>

<h2>Job Search Progress</h2>
<hr />

<ul>
    <li>You have entered <b>@Model.Metrics.NumCompanies</b> companies</li>
    <li>You have entered <b>@Model.Metrics.NumContacts</b> contacts</li>
    <li>You have entered <b>@Model.Metrics.NumTasks</b> tasks</li>

    @if (Model.Metrics.NumTasks > 0)
    {
        <li><b>@Html.DisplayPercentageString(Model.Metrics.NumTasksCompleted, Model.Metrics.NumTasks)</b> of your tasks have been completed</li>
        <li>You have an average of <b>@Html.DisplayPercentageDecimal(Model.Metrics.NumTasks, Model.Metrics.NumCompanies)</b> tasks per company</li>
    }
    
    <li>You have an average of <b>@Html.DisplayPercentageDecimal(Model.Metrics.NumContacts, Model.Metrics.NumCompanies)</b> contacts per company</li>
</ul>

 <h2>Companies</h2>
 <hr />

 <p>
    @Html.ActionLink("Add A New Company", MVC.Company.Add(@Model.JobSearch.Id))
                
    <ul>
        @foreach (Company company in @Model.JobSearch.Companies.OrderBy(x => x.Name).ToList())
        {
            <li>@Html.ActionLink(company.Name, MVC.Company.Details(company.Id))</li>
        }
    </ul>
</p>